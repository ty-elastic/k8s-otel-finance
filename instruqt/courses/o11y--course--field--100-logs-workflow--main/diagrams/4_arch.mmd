flowchart TB
    style logfile fill:#ffff00,stroke-width:4px
    style datastream fill:#ffff00,stroke-width:4px

    style streams_parsing fill:#ffff00,stroke-width:4px

    style esql_query fill:#ffff00,stroke-width:4px
    %% style lookup_index fill:#ffff00,stroke-width:4px
    %% style esql_parse fill:#ffff00,stroke-width:4px
    style esql_agg fill:#ffff00,stroke-width:4px

    %% style transforms_query fill:#ffff00,stroke-width:4px
    %% style transforms_aggregations fill:#ffff00,stroke-width:4px
    %% style transforms_index fill:#ffff00,stroke-width:4px

    %% style alerts fill:#ffff00,stroke-width:4px
    style visualizations fill:#ffff00,stroke-width:4px

    subgraph elasticsearch[Elasticsearch]
        datastream@{shape: cyl}
        visualizations@{ shape: win-pane, label: "Visualizations" }
        lookup_index@{shape: cyl, label: "Lookup Index"}
        transforms_index@{shape: cyl, label: "Cooked Index"} 
        alerts@{ shape: manual-file, label: "Alerts"}
        
        subgraph streams["Streams"]
            streams_parsing("Parsing<br>(Ingest-Time Parsing)")
        end

        streams --> datastream

        subgraph esql["ES|QL"]
            esql_query[\Query/]
            esql_parse("Parsing<br>(Query-Time Parsing)")
            esql_agg[/Aggregations/]
            
            esql_query --> esql_parse
            esql_parse --> esql_agg
            esql_query --> esql_agg
        end

        datastream --> esql_query
        esql_query -.-> lookup_index

        subgraph Transforms
            transforms_query[\Query/]
            transforms_aggregations[/Aggregations/]

            transforms_query --> transforms_aggregations
        end

        transforms_aggregations --> transforms_index
        transforms_index --> alerts

        datastream --> transforms_query
        esql_agg --> visualizations
        esql_agg --> alerts
    end

    logfile@{ shape: doc, label: "Proxy Log file"}
    logfile -.-> streams


    
