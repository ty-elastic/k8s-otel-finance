--- postgresql.yaml	2025-06-26 14:50:04
+++ _courses/o11y--course--field--200-otel-logs--main/postgresql.yaml	2025-06-26 14:49:27
@@ -18,6 +18,55 @@
       labels:
         app: trading
         service: postgresql
+      annotations:
+        io.opentelemetry.discovery.logs.postgresql/enabled: "true"
+        io.opentelemetry.discovery.logs.postgresql/config: |
+          operators:
+          - type: container
+          - type: regex_parser
+            on_error: send
+            parse_from: body
+            regex: '^(?P<timestamp_field>\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}.\d{3} [A-z]+)\s\[\d{2}\]\s(?P<severity_field>[A-Z]+):\s*(?<msg_field>.*)$'
+            timestamp:
+              parse_from: attributes.timestamp_field
+              on_error: send
+              layout_type: strptime
+              layout: '%Y-%m-%d %H:%M:%S.%L %Z'
+          - type: severity_parser
+            parse_from: attributes.severity_field
+            on_error: send
+            mapping:
+              warn: 
+                - WARNING
+                - NOTICE
+              error:
+                - ERROR
+              info: 
+                - LOG
+                - INFO
+              debug1:
+                - DEBUG1
+              debug2:
+                - DEBUG2
+              debug3:
+                - DEBUG3
+              debug4:
+                - DEBUG4
+              debug5:
+                - DEBUG5
+              fatal:
+                - FATAL
+                - PANIC
+          - type: move
+            on_error: send_quiet
+            from: attributes.msg_field
+            to: body
+          - type: remove
+            on_error: send_quiet
+            field: attributes.timestamp_field
+          - type: remove
+            on_error: send_quiet
+            field: attributes.severity_field
     spec:
       containers:
         - name: postgresql
